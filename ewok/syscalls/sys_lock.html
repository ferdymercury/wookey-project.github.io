

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.3.1.2.9. sys_lock &mdash; Wookey 0.9.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/wookey.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.3.1.2.10. sys_get_random" href="sys_get_random.html" />
    <link rel="prev" title="5.3.1.2.8. sys_reset" href="sys_reset.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Wookey
          

          
            
            <img src="../../_static/wookey_w.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../target.html">1. About the WooKey project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">2. Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../demo.html">3. Demo applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture.html">4. Wookey architecture</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">5. EwoK kernel</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#what-is-ewok">5.1. What is EwoK ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#ewok-architecture">5.2. EwoK architecture</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#ewok-api">5.3. EwoK API</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../syscalls.html">5.3.1. Syscalls</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../syscalls.html#general-principles">5.3.1.1. General principles</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../syscalls.html#syscall-overview">5.3.1.2. Syscall overview</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devices.html">5.3.2. Using devices from userland</a></li>
<li class="toctree-l3"><a class="reference internal" href="../perms.html">5.3.3. Permissions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#internals">5.4. Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#faq">5.5. FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../libs.html">6. Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers.html">7. Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javacard/index.html">8. Javacard Applets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tataouine.html">9. Tataouine SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/index.html">10. Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publi.html">11. Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">12. Roadmap</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Wookey</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">5. EwoK microkernel</a> &raquo;</li>
        
          <li><a href="../syscalls.html">5.3.1. EwoK syscalls</a> &raquo;</li>
        
      <li>5.3.1.2.9. sys_lock</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sys-lock">
<span id="id1"></span><h1><a class="toc-backref" href="#id3">5.3.1.2.9. sys_lock</a><a class="headerlink" href="#sys-lock" title="Permalink to this headline">¶</a></h1>
<p>Pure userspace semaphore, as proposed in <code class="docutils literal notranslate"><span class="pre">libstd.h</span></code>, do not permit easy handling
of variable shared between ISR and main threads. ISR treatments do not allow to sleep
or wait for the main thread to release semaphores. The solution to this problem is to instruct Ewok
not to schedule the ISR routine while the shared variable is in use in the main thread.
Of course such a situation ought to be short.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#sys-lock" id="id3">sys_lock</a><ul>
<li><a class="reference internal" href="#id2" id="id4">sys_lock()</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id4">5.3.1.2.9.1. sys_lock()</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">sys_lock</span></code>: postpone the ISR while a lock is set by the main thread.
This efficiently creates a critical section in the main thread with respect
to the ISR thread.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Synchronous syscall, executable in main thread mode only</p>
</div>
<p>In EwoK, all tasks main threads can lock one of their variables without
requesting any specific permission.</p>
<p>The lock syscall has the following API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e_syscall_ret</span> <span class="n">sys_lock</span><span class="p">(</span><span class="n">LOCK_ENTER</span><span class="p">);</span>
<span class="n">e_syscall_ret</span> <span class="n">sys_lock</span><span class="p">(</span><span class="n">LOCK_EXIT</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Locking the task should be done for a very short amount of time, as associated ISR are
postponed, which may generate big slowdown on the associated devices performance.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sys_get_random.html" class="btn btn-neutral float-right" title="5.3.1.2.10. sys_get_random" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sys_reset.html" class="btn btn-neutral" title="5.3.1.2.8. sys_reset" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ANSSI

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.9.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>